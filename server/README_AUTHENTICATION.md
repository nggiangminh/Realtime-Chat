# RealTime Chat Server - Authentication Testing

## Thông tin Server
- **Port**: 8082
- **Database**: PostgreSQL (chatdb)
- **Base URL**: http://localhost:8082

## Endpoints Authentication đã hoàn thiện

### 1. Public Endpoints (không cần authentication)
- `GET /api/test/public` - Test endpoint công khai
- `POST /api/auth/register` - Đăng ký user mới
- `POST /api/auth/login` - Đăng nhập

### 2. Protected Endpoints (cần JWT token)
- `GET /api/auth/me` - Lấy thông tin user hiện tại
- `POST /api/auth/logout` - Đăng xuất (cập nhật last seen)
- `GET /api/test/protected` - Test endpoint cần authentication

## Test Authentication với PowerShell

### 1. Test Public Endpoint
```powershell
Invoke-RestMethod -Uri "http://localhost:8082/api/test/public"
```

### 2. Đăng ký User mới
```powershell
$registerData = @{
    email = "test@example.com"
    password = "password123"
    displayName = "Test User"
}
$response = Invoke-RestMethod -Uri "http://localhost:8082/api/auth/register" -Method POST -ContentType "application/json" -Body ($registerData | ConvertTo-Json)
Write-Output $response
```

### 3. Đăng nhập
```powershell
$loginData = @{
    email = "test@example.com"
    password = "password123"
}
$loginResponse = Invoke-RestMethod -Uri "http://localhost:8082/api/auth/login" -Method POST -ContentType "application/json" -Body ($loginData | ConvertTo-Json)
$token = $loginResponse.data.token
Write-Output "Token: $token"
```

### 4. Test Protected Endpoint với JWT Token
```powershell
$headers = @{
    "Authorization" = "Bearer $token"
}
$userInfo = Invoke-RestMethod -Uri "http://localhost:8082/api/auth/me" -Headers $headers
Write-Output $userInfo
```

### 5. Test Protected Test Endpoint
```powershell
$protectedResponse = Invoke-RestMethod -Uri "http://localhost:8082/api/test/protected" -Headers $headers
Write-Output $protectedResponse
```

### 6. Logout
```powershell
$logoutResponse = Invoke-RestMethod -Uri "http://localhost:8082/api/auth/logout" -Method POST -Headers $headers
Write-Output $logoutResponse
```

## Cấu trúc Database

### Bảng Users
```sql
CREATE TABLE users (
    id BIGINT PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY,
    email VARCHAR(255) NOT NULL UNIQUE,
    password VARCHAR(255) NOT NULL,
    display_name VARCHAR(100) NOT NULL,
    created_at TIMESTAMP NOT NULL,
    last_seen TIMESTAMP
);
```

## Các tính năng đã hoàn thiện

✅ **JWT Authentication**
- Tạo và validate JWT tokens
- Token expiration (24 giờ)
- Secure secret key

✅ **Password Security**
- BCrypt hashing với strength 12
- Password validation

✅ **API Response Format**
- Chuẩn ApiResponse<T> wrapper
- Consistent error handling
- Success/Error status

✅ **Database Integration**
- PostgreSQL connection
- JPA/Hibernate entities
- Repository pattern

✅ **Security Configuration**
- CORS support cho frontend
- JWT filter integration
- Public/Protected endpoints

✅ **Validation**
- Email format validation
- Password length validation
- Input sanitization

✅ **Logging**
- Request/Response logging
- Security event logging
- Debug information

## Cấu trúc Code tuân thủ quy tắc

✅ **SOLID Principles**
✅ **DRY Principles**
✅ **KISS Principles**
✅ **Repository Pattern**
✅ **Service Layer Pattern**
✅ **DTO Pattern**
✅ **Exception Handling**

## Lỗi thường gặp và cách xử lý

1. **Port already in use**: Thay đổi port trong application.properties
2. **Database connection**: Kiểm tra PostgreSQL service và thông tin kết nối
3. **JWT validation failed**: Kiểm tra token format và expiration
4. **CORS issues**: Cấu hình CORS trong SecurityConfig
